{
  "kind": "build_request",
  "title": "Fix runtime crash by wrapping full app tree with AuthzProvider at the root entry",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-58",
      "text": "Ensure the entire React component tree is wrapped by `AuthzProvider` at the application root entry (root-level render), so that no component (Navbar, route guards, pages, etc.) can render outside the provider and trigger `useAuthzState must be used within an AuthzProvider`. Do not change the internal structure of `frontend/src/App.tsx`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Yes, proceed with moving AuthzProvider to the root level in main.jsx or index.js, wrapping BrowserRouter and App. Do not modify internal App.jsx structure."
        ]
      },
      "acceptanceCriteria": [
        "The app no longer shows the runtime error: \"useAuthzState must be used within an AuthzProvider\".",
        "`frontend/src/App.tsx` is not modified.",
        "All routes (public and protected) render without throwing due to missing AuthzProvider."
      ]
    },
    {
      "id": "REQ-59",
      "text": "Because `frontend/src/main.tsx` is an immutable path, implement the root-level provider wrapping by creating a new React entry file (e.g., `frontend/src/main.authz.tsx`) that mirrors the existing provider composition in `frontend/src/main.tsx` but adds `AuthzProvider` to wrap `App`, and then update `frontend/index.html` to load the new entry file instead of `./src/main.tsx`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "proceed with moving AuthzProvider to the root level in main.jsx or index.js, wrapping BrowserRouter and App"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/index.html` references the new entry module (not `./src/main.tsx`).",
        "The new entry module wraps `<App />` with `<AuthzProvider>` above the router-rendered app content.",
        "Existing root providers already used in `frontend/src/main.tsx` (React Query and Internet Identity providers) remain present and functional in the new entry module.",
        "No changes are made to immutable file `frontend/src/main.tsx`."
      ]
    }
  ],
  "constraints": [
    "Do not modify the internal structure of `frontend/src/App.tsx` (no moving providers into App).",
    "Do not edit immutable paths, including `frontend/src/main.tsx`.",
    "Keep user-facing text in English."
  ],
  "nonGoals": [
    "Refactoring route definitions or switching routing libraries.",
    "Changing visual design, layout, or animations.",
    "Backend (Motoko) changes."
  ],
  "imageRequirements": {
    "required": [],
    "edits": [
      ""
    ]
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}